<!doctype html>
<html>
<head><title>Cruzando la calle simulator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>
</head>
<body>
<h1>Te falta calle</h1>
<script>
let game_w = 800;
let game_h = 600;

let config = {
	width: game_w,
	height: game_h,
	physics:{
		default: 'arcade',
		arcade:{
			debug: true
		}
	},
	scene:{
		preload: preload,
		create: create,
		update: update
	}

}

let game = new Phaser.Game(config);

let cursors;

let window_offset;
let car_offset = 32;

let scale_size = 3;
let bg_img;
let man_img;
let car1_img;
let car2_img;
let car3_img;
let car4_img;

let man_speed = 2;
let car1_speed = 2;
let car2_speed = 1.25;
let car3_speed = 0.75;
let car4_speed = 1;

let lives_txt;
let score_txt;

let lives = 3;
let score = 0;

let crossing = false;

function preload () {
	this.load.image("background", "background.png");
	this.load.image("man", "man.png");
	this.load.image("car1", "buggy.png");
	this.load.image("car2", "ambulance.png");
	this.load.image("car3", "taxi.png");
	this.load.image("car4", "bus_school.png"); 

}

function create ()
{
	
	cursors = this.input.keyboard.createCursorKeys();

	bg_img = this.add.image(game_w/2, game_h/2, "background");
	man_img = this.add.image(32, 32, "man");
	car1_img = this.add.image(32, 160, "car1");
	car2_img = this.add.image(32, 224, "car2");
	car3_img = this.add.image(32, 380, "car3");
	car4_img = this.add.image(32, 460, "car4");


	man_img.setScale(scale_size);

	car1_img.setScale(scale_size);
	car1_img.flipX = true;
	car2_img.setScale(scale_size);
	car2_img.flipX = true;
	car3_img.setScale(scale_size);
	car4_img.setScale(3);

	let cars = [car1_img, car2_img, car3_img, car4_img];

	for (let i = 0; i < cars.length; i++){
		this.physics.add.collider(man_img, cars[i], function (player, car){
			resetGame();

			lives--;
			lives_txt.text = lives.toString();
		});
	}

	this.add.text(game_w/2, 64, "VIDAS");
	lives_txt = this.add.text(game_w/2+64, 64, "3");

	this.add.text(game_w/2, 128, "PUNTOS");
	score_txt = this.add.text(game_w/2+64, 32, "0");
	
}

function update () {
	
	if (cursors.up.isDown){
		man_img.y -= man_speed;
	}
	else if (cursors.down.isDown) {
		man_img.y += man_speed;
	}

	if(cursors.left.isDown){
		man_img.x -= man_speed;
	}
	else if (cursors.right.isDown){
		man_img.x += man_speed;
	}

	car1_img.x -= car1_speed;
	car2_img.x -= car2_speed;
	car3_img.x += car3_speed;
	car4_img.x += car4_speed;



	if(man_img.y >= 500){

		crossing = true;

	}

	if(crossing && man_img.y == 0){

		score++;
		crossing = false;
		score_txt.text = score.toString();
	}

}

function check_car (car)
{
	/*
	if (car.flipX && car.x < offset_x)
		car.x
	*/
}



function resetGame()
{

	man_img.x = 100;
	man_img.y = 50;

	car1_img.x = 640;
	car2_img.x = 640;
	car3_img.x = 0;
	car4_img.x = 0;

	crossing = false;
}

</script>
</body>
</html>
